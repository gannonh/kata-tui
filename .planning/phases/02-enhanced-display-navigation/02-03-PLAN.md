---
phase: 02-enhanced-display-navigation
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/tree_view.rs
  - src/components/detail_pane.rs
autonomous: true

must_haves:
  truths:
    - "User sees progress bar for each phase in tree view"
    - "Progress bar fills based on requirement completion percentage"
    - "User sees overall progress in detail pane when phase selected"
  artifacts:
    - path: "src/components/tree_view.rs"
      provides: "Inline progress indicator in tree items"
      contains: "completion_percentage"
    - path: "src/components/detail_pane.rs"
      provides: "Progress bar widget in detail view"
      contains: "LineGauge"
  key_links:
    - from: "src/components/tree_view.rs"
      to: "Phase.completion_percentage()"
      via: "method call in Phase rendering"
      pattern: "phase\\.completion_percentage"
---

<objective>
Implement progress bars showing completion percentages for phases, both inline in the tree view and in the detail pane.

Purpose: Give users immediate visual feedback on phase progress without needing to count completed requirements manually.

Output: Tree view shows inline progress (e.g., "[xx%]" or mini bar), detail pane shows LineGauge widget for selected phase.
</objective>

<execution_context>
@./references/execute-plan.md
@./references/summary-template.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-enhanced-display-navigation/02-RESEARCH.md
@src/components/tree_view.rs
@src/components/detail_pane.rs
@src/data/roadmap.rs
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add inline progress indicator to tree view phases</name>
  <files>src/components/tree_view.rs</files>
  <action>
1. In src/components/tree_view.rs, update TreeItem::to_list_item() for Phase to include progress:

   The current Phase rendering shows: `  [x] Phase N: Name`

   Update to show: `  [x] Phase N: Name [XX%]` or with a mini progress block

   For compact display, use percentage text with color coding:
   ```rust
   TreeItem::Phase(phase) => {
       let status_icon = match phase.status {
           crate::data::PhaseStatus::Complete => "[x]",
           crate::data::PhaseStatus::InProgress => "[~]",
           crate::data::PhaseStatus::Pending => "[ ]",
       };

       let percentage = phase.completion_percentage();
       let progress_text = format!("{:3.0}%", percentage);
       let progress_color = if percentage >= 100.0 {
           Color::Green
       } else if percentage > 0.0 {
           Color::Yellow
       } else {
           Color::DarkGray
       };

       ListItem::new(Line::from(vec![
           Span::raw("  "),
           Span::styled(
               status_icon,
               Style::default().fg(phase.status.color()),
           ),
           Span::raw(" "),
           Span::styled(
               format!("Phase {}: {}", phase.number, phase.name),
               Style::default().add_modifier(Modifier::BOLD),
           ),
           Span::raw(" "),
           Span::styled(
               format!("[{}]", progress_text),
               Style::default().fg(progress_color),
           ),
       ]))
   }
   ```

2. Alternative: Use Unicode block characters for mini progress bar:
   ```rust
   fn mini_progress_bar(percentage: f32, width: usize) -> String {
       let filled = ((percentage / 100.0) * width as f32).round() as usize;
       let empty = width.saturating_sub(filled);
       format!("{}{}", "█".repeat(filled), "░".repeat(empty))
   }
   ```

   Then render as:
   ```rust
   Span::styled(
       format!("[{}]", mini_progress_bar(percentage, 5)),
       Style::default().fg(progress_color),
   ),
   ```

   Recommend starting with percentage text (simpler, more universally supported).

3. Make sure truncate_text accounts for the added progress width when calculating description length.
  </action>
  <verify>
- `cargo build` succeeds
- `cargo run` shows percentage next to each phase in tree view
- Complete phases show [100%] in green
- In-progress phases show partial percentage in yellow
- Empty phases show [  0%] in gray
  </verify>
  <done>Tree view phases display completion percentage with color coding based on progress level.</done>
</task>

<task type="auto">
  <name>Task 2: Add LineGauge progress bar to detail pane for phases</name>
  <files>src/components/detail_pane.rs</files>
  <action>
1. In src/components/detail_pane.rs, add LineGauge import:
   ```rust
   use ratatui::widgets::LineGauge;
   use ratatui::symbols;
   ```

2. Find where Phase details are rendered in the detail pane. Add a progress section.

   In the render function, when displaying a Phase, add after the basic info:
   ```rust
   // Add progress bar for phase
   fn render_phase_progress(phase: &Phase, area: Rect, buf: &mut Buffer) {
       let percentage = phase.completion_percentage();
       let ratio = (percentage / 100.0) as f64;

       let color = if percentage >= 100.0 {
           Color::Green
       } else if percentage > 0.0 {
           Color::Yellow
       } else {
           Color::DarkGray
       };

       let gauge = LineGauge::default()
           .filled_style(Style::default().fg(color))
           .unfilled_style(Style::default().fg(Color::DarkGray))
           .label(format!("{:.0}% complete", percentage))
           .ratio(ratio.clamp(0.0, 1.0));

       gauge.render(area, buf);
   }
   ```

3. Integrate into the detail pane layout. When a Phase is selected:
   - Show phase name and goal at top
   - Show LineGauge below (allocate 1-2 lines)
   - Show requirements list below that

   Update the layout to allocate space:
   ```rust
   // Example layout for phase detail
   let chunks = Layout::default()
       .direction(Direction::Vertical)
       .constraints([
           Constraint::Length(3),  // Title + goal
           Constraint::Length(1),  // Progress bar
           Constraint::Min(0),     // Requirements
       ])
       .split(inner_area);
   ```

4. Use Gauge if LineGauge doesn't fit well visually:
   ```rust
   use ratatui::widgets::Gauge;

   let gauge = Gauge::default()
       .block(Block::default())
       .gauge_style(Style::default().fg(color))
       .percent(percentage as u16)
       .label(format!("{:.0}%", percentage));
   ```

5. Ensure the progress bar looks good at various terminal widths.
  </action>
  <verify>
- `cargo build` succeeds
- `cargo run`, select a phase, see progress bar in detail pane
- Progress bar fills proportionally to completed requirements
- Label shows percentage
- Color matches completion level
  </verify>
  <done>Detail pane shows LineGauge progress bar when a phase is selected. Bar fills based on requirement completion. DISP-05 requirement satisfied.</done>
</task>

</tasks>

<verification>
1. `cargo build --release` compiles without errors
2. `cargo test` - all tests pass
3. `cargo clippy -- -D warnings` - no warnings
4. Manual verification:
   - Launch with `cargo run`
   - Tree view: Each phase shows completion percentage with color
   - Select Phase 1 (complete): See 100% green progress bar in detail
   - Select Phase 2 (pending): See 0% gray progress bar in detail
   - Progress updates reflect actual requirement completion ratios
</verification>

<success_criteria>
- Tree view phases show inline completion percentage
- Percentage is color-coded (green=100%, yellow=partial, gray=0%)
- Detail pane shows LineGauge/Gauge for selected phase
- Progress bar fills proportionally to completion
- Renders correctly at various terminal widths
- DISP-05 requirement fully satisfied
</success_criteria>

<output>
After completion, create `.planning/phases/02-enhanced-display-navigation/02-03-SUMMARY.md`
</output>
