---
phase: 02-enhanced-display-navigation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/state.rs
  - src/update.rs
  - src/components/tree_view.rs
autonomous: true

must_haves:
  truths:
    - "User sees green indicators for complete phases"
    - "User sees yellow indicators for in-progress phases"
    - "User sees gray indicators for pending phases"
  artifacts:
    - path: "src/state.rs"
      provides: "InputMode enum for modal state"
      contains: "enum InputMode"
    - path: "src/components/tree_view.rs"
      provides: "Color-coded status rendering"
      contains: "Color::Green"
  key_links:
    - from: "src/components/tree_view.rs"
      to: "PhaseStatus"
      via: "match on status for color"
      pattern: "PhaseStatus::Complete.*Color::Green"
---

<objective>
Add InputMode state machine foundation and implement color-coded status indicators for phases and requirements.

Purpose: Establish the modal state pattern needed for help/search overlays, and make phase status immediately visible through color coding.

Output: InputMode enum in state.rs, colored status icons in tree view (green=complete, yellow=in-progress, gray=pending).
</objective>

<execution_context>
@./references/execute-plan.md
@./references/summary-template.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-enhanced-display-navigation/02-RESEARCH.md
@src/state.rs
@src/update.rs
@src/components/tree_view.rs
@src/data/roadmap.rs
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add InputMode enum and integrate into AppState</name>
  <files>src/state.rs, src/update.rs</files>
  <action>
1. In src/state.rs, add InputMode enum BEFORE FocusedPane:
   ```rust
   #[derive(Debug, Clone, Copy, PartialEq, Eq, Default)]
   pub enum InputMode {
       #[default]
       Normal,
       Search,
       Help,
   }
   ```

2. Add `input_mode: InputMode` field to AppState struct (after focused_pane field)

3. Initialize `input_mode: InputMode::Normal` in Default impl

4. Add new Message variants to the Message enum:
   - `ShowHelp` - enters Help mode
   - `HideHelp` - exits Help mode
   - `EnterSearchMode` - enters Search mode
   - `ExitSearchMode` - exits Search mode

5. In src/update.rs, add handlers for the new messages:
   ```rust
   Message::ShowHelp => {
       state.input_mode = InputMode::Help;
       true
   }
   Message::HideHelp => {
       state.input_mode = InputMode::Normal;
       true
   }
   Message::EnterSearchMode => {
       state.input_mode = InputMode::Search;
       true
   }
   Message::ExitSearchMode => {
       state.input_mode = InputMode::Normal;
       true
   }
   ```

6. Do NOT modify key_to_message yet - keybindings come in later plans.
  </action>
  <verify>
- `cargo build` succeeds
- `cargo test` passes (existing tests should still work)
- `cargo clippy` has no warnings
  </verify>
  <done>InputMode enum exists with Normal/Search/Help variants. AppState has input_mode field. Message enum has Show/Hide/Enter/Exit variants for mode transitions.</done>
</task>

<task type="auto">
  <name>Task 2: Implement color-coded status indicators (DISP-04)</name>
  <files>src/components/tree_view.rs, src/data/roadmap.rs</files>
  <action>
1. In src/data/roadmap.rs, add color method to PhaseStatus:
   ```rust
   use ratatui::style::Color;

   impl PhaseStatus {
       pub fn color(&self) -> Color {
           match self {
               PhaseStatus::Complete => Color::Green,
               PhaseStatus::InProgress => Color::Yellow,
               PhaseStatus::Pending => Color::DarkGray,
           }
       }
   }
   ```

2. Add same color method to RequirementStatus (same color mapping).

3. In src/components/tree_view.rs, update TreeItem::to_list_item() to use colors:

   For Phase items:
   ```rust
   TreeItem::Phase(phase) => {
       let status_icon = match phase.status {
           crate::data::PhaseStatus::Complete => "[x]",
           crate::data::PhaseStatus::InProgress => "[~]",
           crate::data::PhaseStatus::Pending => "[ ]",
       };
       ListItem::new(Line::from(vec![
           Span::raw("  "),
           Span::styled(
               status_icon,
               Style::default().fg(phase.status.color()),
           ),
           Span::raw(" "),
           Span::styled(
               format!("Phase {}: {}", phase.number, phase.name),
               Style::default().add_modifier(Modifier::BOLD),
           ),
       ]))
   }
   ```

   For Requirement items:
   ```rust
   TreeItem::Requirement { requirement, .. } => {
       let status_icon = match requirement.status {
           crate::data::RequirementStatus::Complete => "[x]",
           crate::data::RequirementStatus::InProgress => "[~]",
           crate::data::RequirementStatus::Pending => "[ ]",
       };
       ListItem::new(Line::from(vec![
           Span::raw("    "),
           Span::styled(
               status_icon,
               Style::default().fg(requirement.status.color()),
           ),
           Span::raw(" "),
           Span::styled(requirement.id.clone(), Style::default().fg(Color::Cyan)),
           Span::raw(": "),
           Span::raw(truncate_text(&requirement.description, 30)),
       ]))
   }
   ```

4. Ensure imports are correct at top of tree_view.rs (Color should already be imported).
  </action>
  <verify>
- `cargo build` succeeds
- `cargo test` passes
- `cargo run` shows colored status indicators:
  - Green [x] for complete items
  - Yellow [~] for in-progress items
  - Gray [ ] for pending items
  </verify>
  <done>Status indicators are color-coded. Complete shows green, in-progress shows yellow, pending shows gray. DISP-04 requirement satisfied.</done>
</task>

</tasks>

<verification>
1. `cargo build --release` compiles without errors
2. `cargo test` - all tests pass
3. `cargo clippy -- -D warnings` - no warnings
4. Manual verification: `cargo run` and observe:
   - Phase 1 (complete) shows green [x]
   - Phase 2 (in-progress/pending) shows yellow [~] or gray [ ]
   - Requirements inherit appropriate colors
</verification>

<success_criteria>
- InputMode enum with Normal, Search, Help variants exists in state.rs
- AppState has input_mode field initialized to Normal
- Message enum has mode transition variants
- PhaseStatus and RequirementStatus have color() methods
- Tree view renders status indicators with semantic colors
- All existing tests pass
- No clippy warnings
</success_criteria>

<output>
After completion, create `.planning/phases/02-enhanced-display-navigation/02-01-SUMMARY.md`
</output>
